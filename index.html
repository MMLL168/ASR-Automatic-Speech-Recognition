<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="基於 ESP32-S3 之離線語音識別產品深度技術報告 - Marlon's Engineering Log">
    <title>Project: EdgeVox | 離線語音識別技術報告</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class', // 啟用 class 模式的手動切換
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        tech: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .dark ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #475569; 
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            line-height: 1.5;
        }
        
        /* Syntax highlighting simulation */
        .token-keyword { color: #c678dd; }
        .token-function { color: #61afef; }
        .token-string { color: #98c379; }
        .token-comment { color: #5c6370; font-style: italic; }
        .token-number { color: #d19a66; }
        .token-type { color: #e5c07b; }
        .token-preproc { color: #e06c75; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-slate-950 text-gray-800 dark:text-slate-300 antialiased font-sans flex h-screen overflow-hidden transition-colors duration-300">

    <!-- Mobile Header -->
    <div class="md:hidden fixed w-full bg-slate-900 text-white z-50 flex justify-between items-center p-4 shadow-md border-b border-slate-700">
        <span class="font-bold text-lg"><i class="fas fa-wave-square mr-2"></i>Project: EdgeVox</span>
        <div class="flex items-center space-x-4">
            <button id="mobile-theme-toggle" class="text-slate-300 hover:text-white focus:outline-none">
                <i class="fas fa-moon"></i>
            </button>
            <button id="mobile-menu-btn" class="text-white focus:outline-none">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="transform -translate-x-full md:translate-x-0 transition-transform duration-300 fixed md:static inset-y-0 left-0 w-72 bg-slate-900 text-slate-300 flex flex-col z-40 h-full border-r border-slate-800 shrink-0 shadow-xl md:shadow-none">
        <div class="p-6 border-b border-slate-700">
            <h1 class="text-xl font-bold text-white tracking-wide"><i class="fas fa-wave-square text-tech-500 mr-2"></i>EdgeVox</h1>
            <p class="text-xs mt-2 text-slate-400">Offline Speech Recognition</p>
            <div class="mt-4 flex items-center space-x-2">
                <div class="h-2 w-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-xs font-mono text-green-400">STATUS: PROTOTYPE v2.1</span>
            </div>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
            <a href="#summary" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-home w-6 text-center"></i> 執行摘要與背景</a>
            <a href="#hardware" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-memory w-6 text-center"></i> 核心硬體架構 (Dual)</a>
            <a href="#display-matrix" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-tv w-6 text-center"></i> 顯示方案決策 (OLED vs LCD)</a>
            <a href="#schematic" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-bezier-curve w-6 text-center"></i> 電路與 PCB 設計</a>
            <a href="#acoustic" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-volume-up w-6 text-center"></i> 聲學結構工程</a>
            <a href="#software" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-code w-6 text-center"></i> 軟體與演算法</a>
            <a href="#power" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-battery-half w-6 text-center"></i> 電源管理</a>
            <a href="#production" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium"><i class="fas fa-industry w-6 text-center"></i> 量產與測試 (DFT)</a>
            <a href="#terminology" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium text-yellow-400"><i class="fas fa-book w-6 text-center"></i> 術語速查表 (Cheat Sheet)</a>
            <a href="#implementation" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium text-green-400"><i class="fas fa-laptop-code w-6 text-center"></i> 實作開發指南</a>
            <a href="#acquisition-deep-dive" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium text-purple-400"><i class="fas fa-satellite-dish w-6 text-center"></i> 數據採集核心詳解 (Deep Dive)</a>
            <a href="#edge-impulse" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium text-blue-400"><i class="fas fa-brain w-6 text-center"></i> Edge Impulse 訓練指南</a>
            <a href="#deployment" class="nav-link block px-3 py-2 rounded-md hover:bg-slate-800 hover:text-white transition-colors text-sm font-medium text-red-400"><i class="fas fa-rocket w-6 text-center"></i> 部署與硬體運行 (Deployment)</a>
        </nav>

        <div class="p-4 border-t border-slate-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-tech-600 flex items-center justify-center text-white font-bold text-xs">M</div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-white">Marlon</p>
                        <p class="text-xs text-slate-500">Engineer</p>
                    </div>
                </div>
                <!-- Desktop Theme Toggle -->
                <button id="desktop-theme-toggle" class="w-8 h-8 rounded-full bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-slate-400 hover:text-yellow-400 transition-colors focus:outline-none" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 h-full overflow-y-auto pt-16 md:pt-0 scroll-smooth bg-gray-50 dark:bg-slate-950">
        <div class="max-w-5xl mx-auto px-6 py-10 md:py-16">
            
            <!-- Header Section -->
            <header class="mb-12 border-b border-gray-200 dark:border-slate-800 pb-8">
                <div class="inline-block bg-tech-100 text-tech-800 dark:bg-tech-900 dark:text-tech-100 px-3 py-1 rounded-full text-xs font-bold mb-4">ENGINEERING REPORT v2.1</div>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-slate-100 leading-tight mb-4">
                    Project: EdgeVox<br>
                    <span class="text-tech-600 dark:text-tech-400">ESP32-S3 離線語音識別深度報告</span>
                </h1>
                <p class="text-lg text-slate-600 dark:text-slate-400 leading-relaxed">
                    本報告詳述了基於 Espressif ESP32-S3、INMP441、MAX98357A 構建的高性能離線語音交互系統。提供 <strong class="text-blue-600 dark:text-blue-400">OLED</strong> 與 <strong class="text-purple-600 dark:text-purple-400">LCD</strong> 雙顯示方案的完整實作指南。
                </p>
            </header>

            <!-- 1. Summary -->
            <section id="summary" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">1</span>
                    執行摘要與市場背景分析
                </h2>
                <div class="bg-white dark:bg-slate-900 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-slate-800 transition-colors">
                    <p class="mb-4 text-gray-700 dark:text-slate-300 leading-7">
                        <strong>Project: EdgeVox</strong> 旨在解決傳統雲端語音方案的延遲與隱私問題。透過 ESP32-S3 的邊緣運算能力，提供即時、離線的語音交互體驗。
                    </p>
                    <div class="border-l-4 border-tech-500 pl-4 py-2 bg-tech-50 dark:bg-slate-800/50">
                        <p class="font-medium text-tech-900 dark:text-tech-100">雙顯示方案架構 (v2.1)：</p>
                        <ul class="list-disc list-inside text-gray-700 dark:text-slate-300 mt-2 space-y-1">
                            <li><strong>方案 A (Lite)</strong>：使用 0.96" OLED (I2C)，極低功耗，適合電池供電設備。</li>
                            <li><strong>方案 B (Pro)</strong>：使用 2.8" TFT LCD (SPI)，全彩視覺，適合智慧中控面板。</li>
                            <li><strong>統一核心</strong>：兩者共用相同的 AI 推理核心與音訊處理邏輯。</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 2. Hardware -->
            <section id="hardware" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">2</span>
                    核心硬體架構 (雙方案)
                </h2>
                
                <!-- Core Components (Shared) -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-microchip text-red-500 text-xl mr-2"></i>
                            <h3 class="font-bold text-slate-800 dark:text-slate-200">ESP32-S3 SoC</h3>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-slate-400">雙核 240MHz, 8MB PSRAM, AI 加速</p>
                    </div>
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-microphone-lines text-green-500 text-xl mr-2"></i>
                            <h3 class="font-bold text-slate-800 dark:text-slate-200">INMP441 Mic</h3>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-slate-400">I2S 全向性 MEMS, 高 SNR</p>
                    </div>
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-xl border border-gray-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center mb-3">
                            <i class="fas fa-volume-high text-purple-500 text-xl mr-2"></i>
                            <h3 class="font-bold text-slate-800 dark:text-slate-200">MAX98357A Amp</h3>
                        </div>
                        <p class="text-xs text-gray-500 dark:text-slate-400">3.2W Class-D, I2S 輸入</p>
                    </div>
                </div>

                <!-- Display Options -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Option A -->
                    <div class="bg-blue-50 dark:bg-blue-900/10 p-6 rounded-xl border border-blue-200 dark:border-blue-800 relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-blue-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold">OPTION A</div>
                        <h3 class="font-bold text-lg text-slate-800 dark:text-slate-200 mb-2">SSD1306 OLED</h3>
                        <ul class="space-y-1 text-sm text-gray-600 dark:text-slate-400">
                            <li>• 尺寸: 0.96吋 (單色)</li>
                            <li>• 介面: I2C (GPIO 8/9)</li>
                            <li>• 優點: 省電、接線少</li>
                        </ul>
                    </div>

                    <!-- Option B -->
                    <div class="bg-purple-50 dark:bg-purple-900/10 p-6 rounded-xl border border-purple-200 dark:border-purple-800 relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-purple-500 text-white text-xs px-3 py-1 rounded-bl-lg font-bold">OPTION B</div>
                        <h3 class="font-bold text-lg text-slate-800 dark:text-slate-200 mb-2">ILI9341 TFT LCD</h3>
                        <ul class="space-y-1 text-sm text-gray-600 dark:text-slate-400">
                            <li>• 尺寸: 2.8吋 (彩色)</li>
                            <li>• 介面: SPI (GPIO 3/46...)</li>
                            <li>• 優點: 視覺豐富、大螢幕</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 2.1 Display Matrix (NEW) -->
            <section id="display-matrix" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">2.1</span>
                    顯示方案決策矩陣 (Decision Matrix)
                </h2>
                <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-slate-800">
                    <table class="min-w-full text-sm text-left">
                        <thead class="bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-slate-300 font-bold">
                            <tr>
                                <th class="px-6 py-3">比較項目</th>
                                <th class="px-6 py-3 text-blue-600 dark:text-blue-400">方案 A: SSD1306 (OLED)</th>
                                <th class="px-6 py-3 text-purple-600 dark:text-purple-400">方案 B: ILI9341 (LCD)</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-slate-700 text-gray-600 dark:text-slate-400">
                            <tr>
                                <td class="px-6 py-3 font-medium">解析度</td>
                                <td class="px-6 py-3">128 x 64 (低)</td>
                                <td class="px-6 py-3">240 x 320 (高)</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-medium">色彩</td>
                                <td class="px-6 py-3">單色 (白/藍/黃)</td>
                                <td class="px-6 py-3">16-bit 全彩 (RGB565)</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-medium">通訊介面</td>
                                <td class="px-6 py-3">I2C (2 線)</td>
                                <td class="px-6 py-3">SPI (5-6 線)</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-medium">佔用 GPIO</td>
                                <td class="px-6 py-3">2 個 (SDA, SCL)</td>
                                <td class="px-6 py-3">5 個 (CLK, MOSI, CS, DC, RST)</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-medium">功耗 (Typ.)</td>
                                <td class="px-6 py-3">20mA (極低)</td>
                                <td class="px-6 py-3">100-150mA (需背光)</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-3 font-medium">推薦應用</td>
                                <td class="px-6 py-3">可攜式、電池供電設備</td>
                                <td class="px-6 py-3">固定式中控、插電設備</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 3. Schematic & PCB -->
            <section id="schematic" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">3</span>
                    電路原理與 PCB 佈局指南
                </h2>

                <!-- Pinout Table -->
                <div class="overflow-x-auto mb-8 rounded-lg border border-gray-200 dark:border-slate-800">
                    <h3 class="font-bold text-lg mb-4 text-slate-700 dark:text-slate-200 px-1">ESP32-S3-WROOM-1 完整引腳分配表</h3>
                    <table class="min-w-full bg-white dark:bg-slate-900">
                        <thead class="bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-semibold text-xs uppercase tracking-wider">
                            <tr>
                                <th class="px-6 py-3 text-left">模組</th>
                                <th class="px-6 py-3 text-left">訊號名稱</th>
                                <th class="px-6 py-3 text-left">ESP32 GPIO</th>
                                <th class="px-6 py-3 text-left">備註</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-slate-800 text-sm">
                            <!-- Mic -->
                            <tr class="hover:bg-gray-50 dark:hover:bg-slate-800">
                                <td class="px-6 py-4 font-medium text-green-600 dark:text-green-400">INMP441 (Mic)</td>
                                <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-400">WS / SCK / SD</td>
                                <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-400">42 / 41 / 42</td>
                                <td class="px-6 py-4 text-slate-600 dark:text-slate-400">I2S0 介面</td>
                            </tr>
                            <!-- Amp -->
                            <tr class="hover:bg-gray-50 dark:hover:bg-slate-800">
                                <td class="px-6 py-4 font-medium text-purple-600 dark:text-purple-400">MAX98357A (Amp)</td>
                                <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-400">LRCK / BCLK / DIN</td>
                                <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-400">41 / 40 / 39</td>
                                <td class="px-6 py-4 text-slate-600 dark:text-slate-400">I2S1 介面</td>
                            </tr>
                            <!-- Option A: OLED -->
                            <tr class="bg-blue-50/50 dark:bg-blue-900/10 hover:bg-blue-100 dark:hover:bg-blue-900/20">
                                <td class="px-6 py-4 font-medium text-blue-600 dark:text-blue-400">SSD1306 (OLED)</td>
                                <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-400">SDA / SCL</td>
                                <td class="px-6 py-4 font-mono font-bold text-slate-800 dark:text-slate-200">8 / 9</td>
                                <td class="px-6 py-4 text-slate-600 dark:text-slate-400">I2C 介面 (方案 A)</td>
                            </tr>
                            <!-- Option B: LCD -->
                            <tr class="bg-purple-50/50 dark:bg-purple-900/10 hover:bg-purple-100 dark:hover:bg-purple-900/20">
                                <td class="px-6 py-4 font-medium text-purple-600 dark:text-purple-400">ILI9341 (LCD)</td>
                                <td class="px-6 py-4 font-mono text-slate-600 dark:text-slate-400">CLK / MOSI / CS / DC / RST</td>
                                <td class="px-6 py-4 font-mono font-bold text-slate-800 dark:text-slate-200">3 / 46 / 14 / 47 / 21</td>
                                <td class="px-6 py-4 text-slate-600 dark:text-slate-400">SPI 介面 (方案 B)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 4. Acoustics -->
            <section id="acoustic" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">4</span>
                    聲學結構工程設計
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-lg border border-gray-200 dark:border-slate-800">
                        <h3 class="font-bold text-slate-800 dark:text-slate-200 mb-2">1. 氣密性設計</h3>
                        <p class="text-sm text-gray-600 dark:text-slate-400">
                            使用橡膠或 PORON® 泡棉墊圈將 INMP441 緊密壓合外殼。防止「聲短路」導致 AEC 演算法失效。
                        </p>
                    </div>
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-lg border border-gray-200 dark:border-slate-800">
                        <h3 class="font-bold text-slate-800 dark:text-slate-200 mb-2">2. 獨立後腔</h3>
                        <p class="text-sm text-gray-600 dark:text-slate-400">
                            揚聲器必須擁有獨立密封後腔 (Back Volume)，實現與麥克風的物理隔離並提升低頻。
                        </p>
                    </div>
                    <div class="bg-white dark:bg-slate-900 p-5 rounded-lg border border-gray-200 dark:border-slate-800">
                        <h3 class="font-bold text-slate-800 dark:text-slate-200 mb-2">3. 減震安裝</h3>
                        <p class="text-sm text-gray-600 dark:text-slate-400">
                            使用軟性矽膠懸浮固定揚聲器，切斷震動通過外殼傳導至麥克風的路徑。
                        </p>
                    </div>
                </div>
            </section>

            <!-- 5. Software -->
            <section id="software" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">5</span>
                    軟體架構與 AI 演算法流程
                </h2>
                
                <div class="bg-slate-900 dark:bg-black text-white p-6 rounded-lg mb-6 overflow-x-auto shadow-inner">
                    <p class="font-mono text-sm text-green-400 mb-2">// Audio Pipeline Data Flow</p>
                    <div class="flex items-center space-x-2 text-sm font-mono whitespace-nowrap">
                        <span class="bg-slate-700 px-3 py-1 rounded border border-slate-600">[INMP441]</span>
                        <i class="fas fa-arrow-right text-gray-500"></i>
                        <span class="bg-slate-700 px-3 py-1 rounded border border-slate-600">I2S DMA</span>
                        <i class="fas fa-arrow-right text-gray-500"></i>
                        <span class="bg-purple-600/80 px-3 py-1 rounded border border-purple-400">Edge Impulse Model</span>
                        <i class="fas fa-arrow-right text-gray-500"></i>
                        <span class="bg-gray-600 px-3 py-1 rounded border border-gray-400">Display Logic (OLED/LCD)</span>
                    </div>
                </div>

                <div class="space-y-4 text-gray-700 dark:text-slate-300 leading-relaxed">
                    <p>
                        <strong class="text-slate-900 dark:text-slate-100">核心技術棧：</strong> ESP-IDF + Edge Impulse + Adafruit Libraries。
                    </p>
                    <ul class="list-disc list-inside space-y-2">
                        <li><strong>I2S 優化：</strong> DMA Buffer 建議設定 <code>count=8, len=512</code>。</li>
                        <li><strong>雙模顯示：</strong> 代碼使用 <code>#ifdef USE_ILI9341</code> 進行條件編譯，一套代碼支援兩種硬體。</li>
                        <li><strong>雙核分配：</strong> 核心 0 負責 I2S/Audio，核心 1 負責 AI 推理與顯示刷新。</li>
                    </ul>
                </div>
            </section>

             <!-- 6. Power -->
             <section id="power" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">6</span>
                    電源管理
                </h2>
                <div class="bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-800 rounded-lg p-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                        <h3 class="font-bold text-lg text-slate-700 dark:text-slate-200">功耗分析比較</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center">
                        <div class="p-4 bg-blue-50 dark:bg-blue-900/10 rounded border border-blue-100 dark:border-blue-900">
                            <p class="text-xs text-gray-500 dark:text-slate-400 uppercase">方案 A (OLED)</p>
                            <p class="text-xl font-bold text-blue-600 dark:text-blue-400">~150 mA</p>
                            <p class="text-xs text-gray-400 mt-1">一般運作</p>
                        </div>
                        <div class="p-4 bg-purple-50 dark:bg-purple-900/10 rounded border border-purple-100 dark:border-purple-900">
                            <p class="text-xs text-gray-500 dark:text-slate-400 uppercase">方案 B (LCD)</p>
                            <p class="text-xl font-bold text-purple-600 dark:text-purple-400">~300 mA</p>
                            <p class="text-xs text-gray-400 mt-1">一般運作 (含背光)</p>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-gray-600 dark:text-slate-400">
                        <strong>Deep Sleep：</strong> < 20 µA (兩方案皆同，需關閉週邊電源)。
                    </div>
                </div>
            </section>

            <!-- 7. Production -->
            <section id="production" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">7</span>
                    量產製造 (MP Plan)
                </h2>

                <div class="mb-8">
                    <h3 class="font-bold text-lg mb-4 text-slate-700 dark:text-slate-200">10k 量產 BOM 成本估算</h3>
                    <table class="min-w-full text-sm text-left text-gray-500 dark:text-slate-400 border border-gray-200 dark:border-slate-800">
                        <thead class="text-xs text-gray-700 dark:text-slate-300 uppercase bg-gray-50 dark:bg-slate-800">
                            <tr>
                                <th class="px-6 py-3">元件</th>
                                <th class="px-6 py-3">規格</th>
                                <th class="px-6 py-3 text-right">方案 A (OLED)</th>
                                <th class="px-6 py-3 text-right">方案 B (LCD)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-white dark:bg-slate-900 border-b dark:border-slate-800">
                                <td class="px-6 py-4 font-medium text-gray-900 dark:text-slate-200">ESP32-S3-WROOM-1</td>
                                <td class="px-6 py-4">N16R8</td>
                                <td class="px-6 py-4 text-right">$3.10</td>
                                <td class="px-6 py-4 text-right">$3.10</td>
                            </tr>
                            <tr class="bg-white dark:bg-slate-900 border-b dark:border-slate-800">
                                <td class="px-6 py-4 font-medium text-gray-900 dark:text-slate-200">INMP441</td>
                                <td class="px-6 py-4">MEMS Mic</td>
                                <td class="px-6 py-4 text-right">$0.65</td>
                                <td class="px-6 py-4 text-right">$0.65</td>
                            </tr>
                            <tr class="bg-white dark:bg-slate-900 border-b dark:border-slate-800">
                                <td class="px-6 py-4 font-medium text-gray-900 dark:text-slate-200">顯示模組</td>
                                <td class="px-6 py-4">OLED / LCD</td>
                                <td class="px-6 py-4 text-right">$1.10</td>
                                <td class="px-6 py-4 text-right">$3.50</td>
                            </tr>
                            <tr class="bg-gray-50 dark:bg-slate-800 border-b dark:border-slate-700">
                                <td class="px-6 py-4 font-bold text-gray-900 dark:text-white" colspan="2">總計 (BOM Cost)</td>
                                <td class="px-6 py-4 text-right font-bold text-green-600 dark:text-green-400">~$6.10</td>
                                <td class="px-6 py-4 text-right font-bold text-purple-600 dark:text-purple-400">~$8.50</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 8. Terminology Cheat Sheet -->
            <section id="terminology" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">8</span>
                    ESP32 語音辨識術語速查表
                </h2>
                
                <!-- 8.1 Core Terms -->
                <div class="mb-10">
                    <h3 class="text-xl font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center">
                        <i class="fas fa-bullseye text-red-500 mr-2"></i> 核心技術四件套 (優先記憶)
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-white dark:bg-slate-900 rounded-lg border-l-4 border-red-500 shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-lg text-slate-900 dark:text-white">ASR</span>
                                <span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded">辨識核心</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Automatic Speech Recognition<br>自動語音辨識，將語音訊號轉為文字。</p>
                        </div>
                        <div class="p-4 bg-white dark:bg-slate-900 rounded-lg border-l-4 border-blue-500 shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-lg text-slate-900 dark:text-white">KWS</span>
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded">喚醒</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Keyword Spotting<br>關鍵詞偵測，低功耗檢測喚醒詞 (如 "Hi, ESP")。</p>
                        </div>
                        <div class="p-4 bg-white dark:bg-slate-900 rounded-lg border-l-4 border-green-500 shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-lg text-slate-900 dark:text-white">VAD</span>
                                <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">偵測</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Voice Activity Detection<br>語音活動檢測，判斷是否有「人聲」存在，過濾靜音。</p>
                        </div>
                        <div class="p-4 bg-white dark:bg-slate-900 rounded-lg border-l-4 border-purple-500 shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-bold text-lg text-slate-900 dark:text-white">MFCC</span>
                                <span class="text-xs bg-purple-100 text-purple-800 px-2 py-0.5 rounded">特徵</span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Mel-Frequency Cepstral Coefficients<br>梅爾頻率倒譜係數，模仿人類聽覺提取的音頻特徵。</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 9. Implementation Guide -->
            <section id="implementation" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">9</span>
                    實作開發指南
                </h2>
                <div class="space-y-8">
                    <!-- 9.1 Hardware & Wiring -->
                    <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-gray-200 dark:border-slate-800">
                        <h3 class="text-xl font-bold text-slate-700 dark:text-slate-200 mb-4 border-b dark:border-slate-700 pb-2">
                            <i class="fas fa-plug text-tech-500 mr-2"></i> 硬體接線配置 (Wiring)
                        </h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- INMP441 Wiring -->
                            <div>
                                <h4 class="font-bold text-sm text-slate-600 dark:text-slate-400 mb-2 uppercase">A. INMP441 (Mic) → ESP32-S3</h4>
                                <table class="w-full text-sm">
                                    <thead class="bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300">
                                        <tr>
                                            <th class="p-2 text-left">INMP441</th>
                                            <th class="p-2 text-left">ESP32 GPIO</th>
                                            <th class="p-2 text-left">備註</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-slate-700 text-gray-700 dark:text-slate-400">
                                        <tr><td class="p-2 font-mono">WS</td><td class="p-2 font-mono text-green-600">42</td><td>左右聲道選擇</td></tr>
                                        <tr><td class="p-2 font-mono">CLK</td><td class="p-2 font-mono text-green-600">41</td><td>位時鐘</td></tr>
                                        <tr><td class="p-2 font-mono">SD</td><td class="p-2 font-mono text-green-600">40</td><td>音頻數據輸出</td></tr>
                                        <tr><td class="p-2 font-mono">L/R</td><td class="p-2 font-mono text-slate-500">GND</td><td>接地=左聲道</td></tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Display Wiring (Dual Option) -->
                            <div>
                                <h4 class="font-bold text-sm text-slate-600 dark:text-slate-400 mb-2 uppercase">B. Display Wiring (Select One)</h4>
                                
                                <!-- Tab Logic -->
                                <div class="mb-2 border-b border-gray-200 dark:border-slate-700 flex">
                                    <span class="px-3 py-1 text-sm font-bold text-blue-600 border-b-2 border-blue-600">SSD1306 (OLED)</span>
                                    <span class="px-3 py-1 text-sm font-bold text-purple-600">ILI9341 (LCD)</span>
                                </div>

                                <table class="w-full text-sm">
                                    <thead class="bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300">
                                        <tr>
                                            <th class="p-2 text-left">Pin</th>
                                            <th class="p-2 text-left">ESP32 GPIO</th>
                                            <th class="p-2 text-left">備註</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200 dark:divide-slate-700 text-gray-700 dark:text-slate-400">
                                        <!-- OLED Rows -->
                                        <tr><td class="p-2 font-mono">SDA</td><td class="p-2 font-mono text-blue-600">8</td><td>I2C Data</td></tr>
                                        <tr><td class="p-2 font-mono">SCL</td><td class="p-2 font-mono text-blue-600">9</td><td>I2C Clock</td></tr>
                                        
                                        <!-- LCD Rows (Visual hint for alternative) -->
                                        <tr class="bg-purple-50 dark:bg-purple-900/10"><td colspan="3" class="p-2 text-xs text-purple-600 text-center">Or Use SPI for LCD: CLK(3), MOSI(46), CS(14), DC(47), RST(21)</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 10. ESP32 Acquisition Deep Dive -->
            <section id="acquisition-deep-dive" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-purple-600 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">10</span>
                    ESP32 數據採集核心詳解 (Acquisition Deep Dive)
                </h2>

                <!-- 10.2 Collection Code -->
                <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-gray-200 dark:border-slate-800 mb-8">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-100 dark:border-slate-800 pb-2">
                        <h3 class="text-xl font-bold text-slate-700 dark:text-slate-200">
                            <i class="fas fa-file-code text-purple-500 mr-2"></i> 專用數據採集代碼 (Data Collection Sketch)
                        </h3>
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded dark:bg-purple-900 dark:text-purple-200">Phase 1: 僅採集用</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        此代碼專注於音訊採集，透過 USB Serial 發送數據。GPIO 已配置為您的專案設定 (40/41/42)。
                    </p>
                    <pre class="code-block"><code class="language-cpp">
<span class="token-preproc">#include &lt;driver/i2s.h&gt;</span>

<span class="token-comment">// ===== GPIO 配置 (已適配您的硬體) =====</span>
<span class="token-preproc">#define I2S_WS   42    </span><span class="token-comment">// LRCK</span>
<span class="token-preproc">#define I2S_SCK  41    </span><span class="token-comment">// SCLK</span>
<span class="token-preproc">#define I2S_SD   40    </span><span class="token-comment">// DOUT</span>

<span class="token-preproc">#define SAMPLE_RATE 16000</span>
<span class="token-preproc">#define SAMPLE_BITS 16</span>

<span class="token-keyword">void</span> <span class="token-function">setup</span>() {
    <span class="token-function">Serial</span>.<span class="token-function">begin</span>(115200);
    <span class="token-function">delay</span>(1000);
    
    <span class="token-comment">// I2S 配置</span>
    i2s_config_t i2s_config = {
        .mode = (i2s_mode_t)(I2S_MODE_MASTER | I2S_MODE_RX),
        .sample_rate = SAMPLE_RATE,
        .bits_per_sample = I2S_BITS_PER_SAMPLE_16BIT,
        .channel_format = I2S_CHANNEL_FMT_ONLY_LEFT, <span class="token-comment">// INMP441 為單聲道</span>
        .communication_format = I2S_COMM_FORMAT_STAND_I2S,
        .intr_alloc_flags = ESP_INTR_FLAG_LEVEL1,
        .dma_buf_count = 8,
        .dma_buf_len = 1024,
        .use_apll = false
    };
    
    i2s_pin_config_t pin_config = {
        .bck_io_num = I2S_SCK,
        .ws_io_num = I2S_WS,
        .data_out_num = -1,
        .data_in_num = I2S_SD
    };
    
    <span class="token-function">i2s_driver_install</span>(I2S_NUM_0, &i2s_config, 0, NULL);
    <span class="token-function">i2s_set_pin</span>(I2S_NUM_0, &pin_config);
    
    <span class="token-function">Serial</span>.<span class="token-function">println</span>(<span class="token-string">"✓ I2S Initialized. Ready for Edge Impulse CLI."</span>);
}

<span class="token-keyword">void</span> <span class="token-function">loop</span>() {
    <span class="token-comment">// 簡單的直通邏輯：CLI 工具會發送請求，我們回應數據</span>
    <span class="token-keyword">if</span> (<span class="token-function">Serial</span>.<span class="token-function">available</span>()) {
        <span class="token-keyword">char</span> cmd = <span class="token-function">Serial</span>.<span class="token-function">read</span>();
        <span class="token-keyword">if</span> (cmd == '1') { <span class="token-comment">// 模擬觸發信號</span>
             <span class="token-function">recordAndSend</span>();
        }
    }
}

<span class="token-keyword">void</span> <span class="token-function">recordAndSend</span>() {
    <span class="token-keyword">const</span> <span class="token-keyword">int</span> AUDIO_LENGTH = SAMPLE_RATE * 1; <span class="token-comment">// 1 秒</span>
    <span class="token-keyword">int16_t</span> audio_buffer[AUDIO_LENGTH];
    <span class="token-keyword">size_t</span> bytes_read = 0;
    
    <span class="token-function">i2s_read</span>(I2S_NUM_0, audio_buffer, AUDIO_LENGTH * 2, &bytes_read, portMAX_DELAY);
    <span class="token-function">Serial</span>.<span class="token-function">write</span>((<span class="token-keyword">uint8_t</span> *)audio_buffer, bytes_read);
}
                    </code></pre>
                </div>
            </section>

            <!-- 11. Edge Impulse Training Deep Dive -->
            <section id="edge-impulse" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-slate-800 dark:bg-slate-700 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">11</span>
                    Edge Impulse 模型訓練與優化詳解
                </h2>
                <!-- Content remains the same -->
                <div class="mb-8">
                    <p class="text-gray-600 dark:text-gray-400 leading-relaxed">
                        本章節將深入探討如何設計高效的語音辨識 Impulse、分析訓練結果並進行優化。請確保您已完成第 10 章的數據採集工作。
                    </p>
                </div>
            </section>

            <!-- 12. Deployment -->
            <section id="deployment" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center">
                    <span class="bg-red-500 text-white w-8 h-8 rounded flex items-center justify-center text-sm mr-3">12</span>
                    部署與硬體運行 (Deployment)
                </h2>
                
                <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-gray-200 dark:border-slate-800 mb-8">
                    <h3 class="text-xl font-bold text-slate-700 dark:text-slate-200 mb-4 border-b dark:border-slate-700 pb-2">
                        <i class="fas fa-file-export text-red-500 mr-2"></i> 1. 下載與安裝 Arduino 庫
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        模型訓練完成後，我們需要將其打包成 Arduino 庫。
                    </p>
                    <ol class="list-decimal list-inside space-y-3 text-sm text-gray-600 dark:text-gray-400">
                        <li>在 Edge Impulse 左側選單點擊 <strong>Deployment</strong>。</li>
                        <li>搜尋並選擇 <strong>Arduino Library</strong>。</li>
                        <li>點擊下方的 <strong>Build</strong> 按鈕。</li>
                        <li>下載生成的 ZIP 檔案 (例如: <code>esp32-project-v1.zip</code>)。</li>
                        <li>打開 Arduino IDE，選單：<strong>Sketch -> Include Library -> Add .ZIP Library...</strong>，選擇剛下載的 ZIP。</li>
                    </ol>
                </div>

                <div class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-gray-200 dark:border-slate-800 mb-8">
                    <h3 class="text-xl font-bold text-slate-700 dark:text-slate-200 mb-4 border-b dark:border-slate-700 pb-2">
                        <i class="fas fa-code-branch text-red-500 mr-2"></i> 2. 雙模驅動代碼 (Dual-Mode Code)
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                        這是支援 OLED 與 LCD 的完整整合代碼。請修改開頭的 <code>#define</code> 來切換模式。
                    </p>
                    <div class="bg-slate-50 dark:bg-black p-4 rounded font-mono text-xs overflow-x-auto border border-slate-200 dark:border-slate-700">
                        <pre class="code-block"><code class="language-cpp">
<span class="token-comment">// ==========================================</span>
<span class="token-comment">// CONFIGURATION: 選擇您的顯示方案</span>
<span class="token-comment">// ==========================================</span>
<span class="token-comment">// #define USE_OLED_SSD1306  // 方案 A: 0.96" OLED</span>
<span class="token-preproc">#define USE_LCD_ILI9341   </span><span class="token-comment">// 方案 B: 2.8" LCD</span>

<span class="token-preproc">#include &lt;SPI.h&gt;</span>
<span class="token-preproc">#include &lt;Wire.h&gt;</span>
<span class="token-preproc">#include &lt;Adafruit_GFX.h&gt;</span>
<span class="token-preproc">#include &lt;ESP32-Voice-Commands_inferencing.h&gt;</span>

<span class="token-preproc">#ifdef USE_OLED_SSD1306</span>
<span class="token-preproc">#include &lt;Adafruit_SSD1306.h&gt;</span>
<span class="token-preproc">#define SCREEN_W 128</span>
<span class="token-preproc">#define SCREEN_H 64</span>
<span class="token-type">Adafruit_SSD1306</span> display(SCREEN_W, SCREEN_H, &Wire, -1);
<span class="token-preproc">#endif</span>

<span class="token-preproc">#ifdef USE_LCD_ILI9341</span>
<span class="token-preproc">#include &lt;Adafruit_ILI9341.h&gt;</span>
<span class="token-preproc">#define TFT_CS   14</span>
<span class="token-preproc">#define TFT_DC   47</span>
<span class="token-preproc">#define TFT_MOSI 46</span>
<span class="token-preproc">#define TFT_SCLK 3</span>
<span class="token-preproc">#define TFT_RST  21</span>
<span class="token-type">Adafruit_ILI9341</span> display = <span class="token-type">Adafruit_ILI9341</span>(TFT_CS, TFT_DC, TFT_MOSI, TFT_SCLK, TFT_RST);
<span class="token-preproc">#endif</span>

<span class="token-comment">// I2S 接線定義 (共用)</span>
<span class="token-preproc">#define I2S_WS    42</span>
<span class="token-preproc">#define I2S_SCK   41</span>
<span class="token-preproc">#define I2S_SD    40</span>

<span class="token-keyword">void</span> <span class="token-function">setup</span>() {
    <span class="token-function">Serial</span>.<span class="token-function">begin</span>(115200);
    
    <span class="token-comment">// --- Display Init ---</span>
<span class="token-preproc">#ifdef USE_OLED_SSD1306</span>
    <span class="token-keyword">if</span>(!display.<span class="token-function">begin</span>(SSD1306_SWITCHCAPVCC, 0x3C)) { 
        <span class="token-function">Serial</span>.<span class="token-function">println</span>(<span class="token-string">"OLED Init Failed"</span>); 
    }
    display.<span class="token-function">clearDisplay</span>();
    display.<span class="token-function">setTextColor</span>(SSD1306_WHITE);
<span class="token-preproc">#endif</span>

<span class="token-preproc">#ifdef USE_LCD_ILI9341</span>
    display.<span class="token-function">begin</span>();
    display.<span class="token-function">setRotation</span>(3); 
    display.<span class="token-function">fillScreen</span>(ILI9341_BLACK);
    display.<span class="token-function">setTextColor</span>(ILI9341_WHITE);
<span class="token-preproc">#endif</span>

    display.<span class="token-function">setTextSize</span>(2);
    display.<span class="token-function">setCursor</span>(0, 0);
    display.<span class="token-function">println</span>(<span class="token-string">"EdgeVox Init..."</span>);
<span class="token-preproc">#ifdef USE_OLED_SSD1306</span>
    display.<span class="token-function">display</span>();
<span class="token-preproc">#endif</span>

    <span class="token-comment">// ... (EI & I2S Init) ...</span>
}

<span class="token-keyword">void</span> <span class="token-function">loop</span>() {
    <span class="token-comment">// ... (Run Inference) ...</span>
    
    <span class="token-comment">// Display Result</span>
<span class="token-preproc">#ifdef USE_LCD_ILI9341</span>
    display.<span class="token-function">fillRect</span>(0, 40, 320, 100, ILI9341_BLACK);
    display.<span class="token-function">setCursor</span>(10, 40);
<span class="token-preproc">#endif</span>
<span class="token-preproc">#ifdef USE_OLED_SSD1306</span>
    display.<span class="token-function">clearDisplay</span>();
    display.<span class="token-function">setCursor</span>(0, 0);
<span class="token-preproc">#endif</span>

    display.<span class="token-function">print</span>(<span class="token-string">"Cmd: "</span>);
    display.<span class="token-function">println</span>(result_label);
    display.<span class="token-function">print</span>(<span class="token-string">"Conf: "</span>);
    display.<span class="token-function">print</span>(confidence * 100);
    display.<span class="token-function">println</span>(<span class="token-string">"%"</span>);

<span class="token-preproc">#ifdef USE_OLED_SSD1306</span>
    display.<span class="token-function">display</span>();
<span class="token-preproc">#endif</span>
}
                        </code></pre>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="mt-20 border-t border-gray-200 dark:border-slate-800 pt-8 text-center text-sm text-gray-500 dark:text-slate-500 pb-12">
                <p>&copy; 2024 Marlon's Engineering Lab. All rights reserved.</p>
                <p class="mt-2">Documentation generated for GitHub Pages.</p>
                <div class="mt-4 flex justify-center space-x-4">
                    <a href="#" class="text-gray-400 hover:text-gray-600 dark:hover:text-slate-300"><i class="fab fa-github text-xl"></i></a>
                    <a href="#" class="text-gray-400 hover:text-gray-600 dark:hover:text-slate-300"><i class="fab fa-linkedin text-xl"></i></a>
                </div>
            </footer>

        </div>
    </main>

    <script>
        // --- Theme Toggle Logic ---
        const html = document.documentElement;
        const mobileToggle = document.getElementById('mobile-theme-toggle');
        const desktopToggle = document.getElementById('desktop-theme-toggle');
        const mobileIcon = mobileToggle.querySelector('i');
        const desktopIcon = desktopToggle.querySelector('i');

        // Check Local Storage or System Preference
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                html.classList.add('dark');
                updateIcons(true);
            } else {
                html.classList.remove('dark');
                updateIcons(false);
            }
        }

        // Update Icons based on theme
        function updateIcons(isDark) {
            const iconClass = isDark ? 'fa-sun' : 'fa-moon';
            mobileIcon.className = `fas ${iconClass}`;
            desktopIcon.className = `fas ${iconClass}`;
        }

        // Toggle Function
        function toggleTheme() {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                updateIcons(false);
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                updateIcons(true);
            }
        }

        mobileToggle.addEventListener('click', toggleTheme);
        desktopToggle.addEventListener('click', toggleTheme);
        
        // Initialize on load
        initTheme();

        // --- Mobile Menu Logic ---
        const btn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');

        btn.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });

        // Close sidebar on link click (mobile)
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 768) {
                    sidebar.classList.add('-translate-x-full');
                }
            });
        });

        // Smooth active state on scroll
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('.nav-link');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 150) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('bg-slate-800', 'text-white');
                if (link.getAttribute('href').includes(current)) {
                    link.classList.add('bg-slate-800', 'text-white');
                }
            });
        });
    </script>
</body>
</html>
